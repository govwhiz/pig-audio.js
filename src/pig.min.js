!function(t){"use strict";function e(t,e,i,s){var n="#"+t+" {  position: relative;}."+e+"-figure {  overflow: hidden;  left: 0;  position: absolute;  top: 0;  margin: 0;}."+e+"-figure .track-list-item {  left: 0;  position: absolute;  top: 0;  line-height: "+s+"px;  height: "+s+"px;  width: 100%;  transition: "+i/1e3+"s ease opacity;  -webkit-transition: "+i/1e3+"s ease opacity;}",o=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=n:a.appendChild(document.createTextNode(n)),o.appendChild(a)}function i(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}function s(t,s){return this.inRAF=!1,this.isTransitioning=!1,this.latestYOffset=0,this.scrollDirection="down",this.visibleAudios=[],this.settings={containerId:"pig-audio",classPrefix:"pig-audio",figureTagName:"figure",trackHeight:50,spaceBetweenAudios:1,transitionSpeed:500,primaryAudioBufferHeight:1e3,secondaryAudioBufferHeight:300,urlForAudio:function(t){return t}},i(this.settings,s||{}),this.elements=this._parseAudioData(t),e(this.settings.containerId,this.settings.classPrefix,this.settings.transitionSpeed,this.settings.trackHeight),this}function n(t,e,i){return this.existsOnPage=!1,this.duration=t.duration,this.filename=t.filename,this.ordinal=t.ordinal,this.submissionId=t.submissionId,this.submissionPk=t.submissionPk,this.index=e,this.pig=i,this.classNames={figure:i.settings.classPrefix+"-figure"},this}var o=function(){function t(){s||(s=!0,window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,66))}function e(){i.forEach(function(t){t()}),s=!1}var i=[],s=!1;return{add:function(e){i.length||window.addEventListener("resize",t),i.push(e)},disable:function(){window.removeEventListener("resize",t)},reEnable:function(){window.addEventListener("resize",t)}}}();s.prototype._getTransitionTimeout=function(){var t=1.5;return this.settings.transitionSpeed*t},s.prototype._getTransitionString=function(){return this.isTransitioning?this.settings.transitionSpeed/1e3+"s transform ease":"none"},s.prototype._parseAudioData=function(t){var e=[];return t.forEach(function(t,i){var s=new n(t,i,this);e.push(s)}.bind(this)),e},s.prototype._computeLayout=function(){var t=parseInt(this.container.clientWidth),e=0,i=this.container.offsetTop-this.container.parentElement.offsetTop,s=0;this.isTransitioning||(this.isTransitioning=!0,setTimeout(function(){this.isTransitioning=!1},this._getTransitionTimeout()));var n=this._getTransitionString();[].forEach.call(this.elements,function(o,a){o.style={width:parseInt(t),height:this.settings.trackHeight,translateX:e,translateY:s,scrollTo:s+i,transition:n},s+=this.settings.trackHeight+this.settings.spaceBetweenAudios}.bind(this)),this.totalHeight=s-this.settings.spaceBetweenAudios},s.prototype._setTotalHeight=function(){var t=0;[].forEach.call(this.elements,function(e,i){t+=this.settings.trackHeight+this.settings.spaceBetweenAudios}.bind(this)),this.totalHeight=t-this.settings.spaceBetweenAudios},s.prototype._doLayout=function(){this.container.style.height=this.totalHeight+"px";var t="up"===this.scrollDirection?this.settings.primaryAudioBufferHeight:this.settings.secondaryAudioBufferHeight,e="down"===this.scrollDirection?this.settings.primaryAudioBufferHeight:this.settings.secondaryAudioBufferHeight,i=this.scrollElement.offsetHeight,s=this.latestYOffset-t,n=this.latestYOffset+i+e;this.elements.forEach(function(t){t.style.translateY<=this.latestYOffset&&t.style.translateY+t.style.height>=this.latestYOffset&&(window.name=t.submissionId),t.style.translateY+t.style.height<s||t.style.translateY>n?t.hide():t.load()}.bind(this))},s.prototype._getOnScroll=function(){var t=this,e=function(){var e=t.scrollElement.scrollTop;t.previousYOffset=t.latestYOffset||e,t.latestYOffset=e,t.scrollDirection=t.latestYOffset>t.previousYOffset?"down":"up",t.inRAF||(t.inRAF=!0,window.requestAnimationFrame(function(){t._doLayout(),t.inRAF=!1}))};return e},s.prototype.enable=function(){return this.container=document.getElementById(this.settings.containerId),this.scrollElement=this.container.parentElement,this.container?(this.onScroll=this._getOnScroll(),this.scrollElement.addEventListener("scroll",this.onScroll),this.onScroll(),this._computeLayout(),this._doLayout(),o.add(function(){this._computeLayout(),this._doLayout()}.bind(this)),this):void console.error("Could not find element with ID "+this.settings.containerId)},s.prototype.disable=function(){return this.scrollElement.removeEventListener("scroll",this.onScroll),o.disable(),this},s.prototype.updateAudio=function(t){var e=this._parseAudioData(t),i=e[0].submissionId,s=e[0].submissionPk,n=null,o=0;this.elements.forEach(function(t,e,a){var r=a[e+1];t.submissionId===i&&(o++,null===n&&(n=e),t.hide()),r&&s<t.submissionPk&&s>r.submissionPk&&null===n&&(n=e+1)}),null===n&&(n=s-this.elements[0].submissionPk>0?0:this.elements.length),Array.prototype.splice.apply(this.elements,[n,o].concat(e)),this._computeLayout(),this._doLayout()},s.prototype.deleteAudio=function(t){var e=null,i=0;this.elements.forEach(function(s,n){s.submissionId===t&&(i++,null===e&&(e=n),s.hide())}),null===e&&(e=0),this.elements.splice(e,i),this._computeLayout(),this._doLayout()},n.prototype.load=function(){this.existsOnPage=!0,this._updateStyles(),this.pig.container.appendChild(this.getElement()),setTimeout(function(){if(this.existsOnPage&&!this.audio){var t=this.getElement(),e=document.createElement("span"),i=document.createElement("div"),s=document.createElement("span"),n=document.createElement("span"),o=document.createElement("div"),a=document.createTextNode(this.ordinal),r=document.createTextNode(this.submissionPk+" - "),h=this.pig.settings.urlForAudio(this.filename),l=document.createTextNode(h),u=document.createTextNode(this.duration?"00"===this.duration.substr(0,2)?this.duration.substr(3,this.duration.length-1):this.duration:"");this.audio=document.createElement("div"),e.className="ordinal",i.className="content",s.className="group",n.className="filename",o.className="duration",this.audio.className="track-list-item",e.appendChild(a),s.appendChild(r),n.appendChild(l),i.appendChild(s),i.appendChild(n),o.appendChild(u),this.audio.appendChild(e),this.audio.appendChild(i),this.audio.appendChild(o),this.audio.addEventListener("click",function(t){this.pig.settings.click(this.submissionId,this.filename)}.bind(this)),t.appendChild(this.audio)}}.bind(this),100)},n.prototype.hide=function(){this.getElement()&&this.audio&&(this.getElement().removeChild(this.audio),delete this.audio),this.existsOnPage&&this.pig.container.removeChild(this.getElement()),this.existsOnPage=!1},n.prototype.getElement=function(){return this.element||(this.element=document.createElement(this.pig.settings.figureTagName),this.element.className=this.classNames.figure,this._updateStyles()),this.element},n.prototype._updateStyles=function(){this.getElement().style.transition=this.style.transition,this.getElement().style.width=this.style.width+"px",this.getElement().style.height=this.style.height+"px",this.getElement().style.transform="translate3d("+this.style.translateX+"px,"+this.style.translateY+"px, 0)"},"function"==typeof define&&define.amd?define(s):"undefined"!=typeof module&&module.exports?module.exports=s:t.PigAudio=s}(this);